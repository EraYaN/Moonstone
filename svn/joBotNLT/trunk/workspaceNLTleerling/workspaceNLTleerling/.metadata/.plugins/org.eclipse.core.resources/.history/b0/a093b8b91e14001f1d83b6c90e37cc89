package javaBot.Nano.Servo;

// ToDo: When using servos 2,3,4 servo 0 and 1 are always running too.
//       Error in OpenVBB ?

import com.muvium.apt.PeriodicTimer;

/**
 * TestBehavior
 * Tests all functions of the robot
 */	

public class TestBehavior extends Behavior
{
	private int 	state = 0;
	private BaseController	joBot;
	private int		s1 = 0;
	private int		count = 0;
	private int		i = 0;
	private boolean blu = false;
	private boolean yel = false;
	private boolean grn = false;
	private static final int wait = 20;

	public TestBehavior(BaseController initJoBot, PeriodicTimer tick,
			int servicePeriod)
	{
		super(initJoBot, tick, servicePeriod);
		joBot = initJoBot;
	}

	public void doBehavior() {
		if (state == 0) {
			joBot.setStatusLeds(true, true, true);
			joBot.setFieldLeds(true);
			joBot.drive(0, 0);
			state = 1;
			count = 0;
		}
		
		if (state == 1) {
			joBot.setStatusLeds(true, true, true);
			if (count++ >= wait) {
				count = 0;
				state = 2;
			}
		}	
		
		if (state == 2) {
			joBot.setStatusLeds(false, false, false);
			joBot.drive(100, 0);
			if (count++ >= wait) {
				count = 0;
				state = 3;
			}
		}	
		
		if (state == 3) {
			joBot.drive(-100, 0);
			if (count++ >= wait) {
				count = 0;
				state = 4;
			}
		}	
		
		if (state == 4) {
			joBot.setStatusLeds(false, false, false);
			joBot.drive(0, 100);
			if (count++ >= wait) {
				count = 0;
				state = 5;
			}
		}	
		
		if (state == 5) {
			joBot.drive(0, -100);
			if (count++ >= wait) {
				count = 0;
				state = 6;
			}
		}	
		
		if (state == 6) {
			joBot.drive(0, 0);
				state = 7;
		}	
		
		if (state == 7) {
			joBot.setServo(2, 0);
			joBot.setServo(3, 0);
			joBot.setServo(4, 0);
			if (count++ >= wait) {
				count = 0;
				state = 8;
			}
		}	
		
		if (state == 8) {
			joBot.setServo(2, 246);
			joBot.setServo(3, 246);
			joBot.setServo(4, 246);
			if (count++ >= wait) {
				count = 0;
				state = 9;
			}
		}	
		
		if (state == 9) {
			blu = false;
			yel = false;
			grn = false;
			s1 = joBot.getSensorValue(joBot.SENSOR_DS);
			if (s1 > 300) blu = true;
			
			s1 = joBot.getSensorValue(joBot.SENSOR_FL);
			if (s1 > 600) yel = true;
			
			s1 = joBot.getSensorValue(joBot.SENSOR_FR);
			if (s1 > 600) grn = true;
			
			s1 = joBot.getSensorValue(joBot.SENSOR_IL);
			if (s1 < 500) yel = true;
			
			s1 = joBot.getSensorValue(joBot.SENSOR_IR);
			if (s1 < 500) grn = true;
			
			joBot.setLed(joBot.LED_YELLOW, yel == true);
			joBot.setLed(joBot.LED_GREEN, grn == true);
			joBot.setLed(joBot.LED_BLUE, blu == true);
			state = 6;
		}	
	}
}
